<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/transferencia.css">
    <title>GOIA Bankline - Transferência</title>
    <link rel="icon" type="image/png" href="/static/img/goia-icon-header.png">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
<header>
    <img src="static/img/goia-icon-header.png" alt="Logo Ícone" class="icone-goia" style="width: 52px;">
    <h1 style="font-family: 'Outfit', sans-serif; font-weight: 600; color: #ff4f5a; margin-top: 10px; font-size: 26px;">GOIA Bank</h1>
    <nav class="menu">
        <img src="static/img/person.png" alt="Ícone de usuário" class="icone-user">
        <div class="dados-conta">
            <h6 class="agencia" id="agencia">ag: 0000</h6><h6 class="conta" id="conta">c/c: 00000-0</h6>
        </div>
        <img src="static/img/notifications.png" alt="Sino de notificação" class="notificacao">
        <div class="sair">
            <h6 class="sair-txt">Sair</h6>
            <img src="static/img/seta-entrada.svg" alt="Seta de sair">
        </div>
    </nav>
</header>

<div class="container-principal">
    <h3>Transferência entre Contas</h3>

    <section class="conteudo-principal">
        <div class="container-transferencias">
            <h2>Insira os dados de transferência</h2>

            <!-- saldo e mensagem de erro/retorno -->
            <p>Saldo Atual: R$ <span id="saldoAtual">Carregando...</span></p>
            <p id="mensagem" style="color:red;"></p>

            <!-- form que envia para sua servlet em /transferencia -->
            <form id="transfer-form" action="transferencia" method="post">
                <div class="form-field">
                    <label for="cpfDestino" class="form-label">CPF (chave Pix)</label>
                    <input
                            type="text"
                            id="cpfDestino"
                            name="cpfMasked"
                            class="form-input"
                            placeholder="000.000.000-00"
                            maxlength="14"
                            required>
                </div>
                <div class="form-field">
                    <label for="amount" class="form-label">Valor (R$)</label>
                    <input
                            type="text"
                            id="amount"
                            name="valor"
                            class="form-input"
                            placeholder="0,00"
                            required>
                </div>
                <button type="submit" class="btn-transfer">Transferir</button>
            </form>

        </div>
    </section>
</div>

<!-- FOOTER -->
<!-- FOOTER -->
<footer class="footer">
    <div class="footer__section">
        <h4>Banco GOIA</h4>
        <p>
            Rua Casa da Atriz, 969, Vila Olímpia<br>
            Horário de funcionamento: 10h às 17h
        </p>
    </div>
    <div class="footer__section">
        <h4>Atendimento</h4>
        <p>
            Central de Relacionamento<br>
            Ligue no 4004 123456
        </p>
    </div>
    <div class="footer__section">
        <h4>SAC</h4>
        <p>
            Para registrar sugestões,<br>
            reclamações ou elogios:<br>
            0800 123 1234
        </p>
        <p>
            Ouvidoria:<br>
            0800 123 1234
        </p>
    </div>
    <!-- NPS existente -->
    <div class="container-nps">
        <div class="nps-header">
            <h5>Avalie o nosso serviço</h5>
            <hr>
        </div>
        <div class="faces">
            <div class="face-item" data-feedback="1">
                <img src="/static/img/mau-rosa.png" alt="Insatisfeito">
                <h6>Insatisfeito</h6>
            </div>
            <div class="face-item" data-feedback="2">
                <img src="/static/img/medio-rosa.png" alt="Indiferente">
                <h6>Indiferente</h6>
            </div>
            <div class="face-item" data-feedback="3">
                <img src="/static/img/ok-rosa.png" alt="Satisfeito">
                <h6>Satisfeito</h6>
            </div>
            <div class="face-item" data-feedback="4">
                <img src="/static/img/feliz-rosa.png" alt="Muito satisfeito">
                <h6>Muito satisfeito</h6>
            </div>

        </div>
    </div>
    <div class="img-24h">
        <img src="/static/img/24h.png" alt="24H">
    </div>
</footer>


<script src="/static/js/url-manager.js"></script>  <!-- Gerenciador de URLs dinâmicas -->
<script src="/static/js/transferencia.js"></script>

<!-- Script para mostrar mensagens do servidor -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Busca mensagem da sessão via AJAX
    fetch('/api/mensagem')
        .then(response => response.json())
        .then(data => {
            if (data.mensagem) {
                Swal.fire({
                    title: 'Transferência',
                    text: data.mensagem,
                    icon: data.mensagem.toLowerCase().includes('sucesso') ? 'success' : 'error',
                    confirmButtonText: 'OK'
                });
            }
        })
        .catch(error => {
            console.log('Erro ao buscar mensagem:', error);

            // Fallback: verifica se há mensagem via URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const msg = urlParams.get('msg');

            if (msg) {
                Swal.fire({
                    title: 'Transferência',
                    text: decodeURIComponent(msg),
                    icon: msg.toLowerCase().includes('sucesso') ? 'success' : 'error',
                    confirmButtonText: 'OK'
                });
            }
        });
});
</script>

<!-- overlay de loading (fica escondido) -->
<div id="loadingOverlay" class="overlay hidden">
    <div class="loader">
        <svg class="ring" viewBox="0 0 80 80">
            <circle class="track"    cx="40" cy="40" r="35"/>
            <circle class="progress" cx="40" cy="40" r="35"/>
        </svg>
        <span id="loaderPercent">0&nbsp;%</span>
    </div>
</div>

</body>
</html>
